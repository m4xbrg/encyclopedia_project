---
import SidebarTree, { type SidebarTreeNode } from '../components/SidebarTree.astro';
import TOCPanel, { type TOCItem } from '../components/TOCPanel.astro';

export interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Props {
  title: string;
  summary?: string;
  difficulty?: string;
  estimatedTime?: string;
  breadcrumbs?: BreadcrumbItem[];
  sidebarTree?: SidebarTreeNode[];
  toc?: TOCItem[];
}

const {
  title,
  summary,
  difficulty,
  estimatedTime,
  breadcrumbs = [],
  sidebarTree = [],
  toc = [],
} = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
  </head>
  <body>
    <div class="topic-layout">
      <div class="topic-layout__sidebar">
        <SidebarTree tree={sidebarTree} />
      </div>

      <main class="topic-layout__content">
        {breadcrumbs.length > 0 && (
          <nav aria-label="Breadcrumb" class="breadcrumbs">
            <ol>
              {breadcrumbs.map((crumb, index) => (
                <li>
                  {crumb.href && index < breadcrumbs.length - 1 ? (
                    <a href={crumb.href}>{crumb.label}</a>
                  ) : (
                    <span>{crumb.label}</span>
                  )}
                </li>
              ))}
            </ol>
          </nav>
        )}

        <header>
          <h1>{title}</h1>
          {(difficulty || estimatedTime) && (
            <div class="meta-chips">
              {difficulty && <span class="chip chip--difficulty">{difficulty}</span>}
              {estimatedTime && <span class="chip chip--time">{estimatedTime}</span>}
            </div>
          )}
          {summary && <p class="summary">{summary}</p>}
        </header>

        <article>
          <slot />
        </article>
      </main>

      <div class="topic-layout__toc">
        <TOCPanel items={toc} />
      </div>
    </div>
  </body>
</html>

<style>
  :global(body) {
    margin: 0;
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f8fafc;
    color: #0f172a;
  }

  .topic-layout {
    display: grid;
    grid-template-columns: 260px minmax(0, 1fr) 240px;
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  .topic-layout__sidebar,
  .topic-layout__toc {
    min-width: 0;
  }

  main {
    background: #fff;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 10px 40px rgba(15, 23, 42, 0.08);
  }

  header {
    margin-bottom: 2rem;
  }

  h1 {
    font-size: clamp(2rem, 4vw, 2.6rem);
    margin: 0;
    color: #0f172a;
  }

  .summary {
    margin-top: 0.75rem;
    color: #475569;
    font-size: 1.05rem;
  }

  .meta-chips {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
    flex-wrap: wrap;
  }

  .chip {
    display: inline-flex;
    align-items: center;
    padding: 0.35rem 0.8rem;
    border-radius: 999px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .chip--difficulty {
    background: rgba(244, 114, 182, 0.15);
    color: #be185d;
  }

  .chip--time {
    background: rgba(59, 130, 246, 0.15);
    color: #1d4ed8;
  }

  .breadcrumbs {
    font-size: 0.85rem;
    margin-bottom: 1.25rem;
    color: #64748b;
  }

  .breadcrumbs ol {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.35rem;
  }

  .breadcrumbs li::after {
    content: '/';
    margin-left: 0.35rem;
    color: #cbd5f5;
  }

  .breadcrumbs li:last-child::after {
    content: '';
  }

  .breadcrumbs a {
    color: inherit;
    text-decoration: none;
  }

  .breadcrumbs span {
    font-weight: 600;
    color: #1e293b;
  }

  article {
    line-height: 1.7;
    color: #0f172a;
  }

  article :global(h2),
  article :global(h3),
  article :global(h4) {
    color: #0f172a;
    margin-top: 2rem;
  }

  article :global(p) {
    color: #475569;
  }

  @media (max-width: 1100px) {
    .topic-layout {
      grid-template-columns: 220px minmax(0, 1fr);
    }

    .topic-layout__toc {
      display: none;
    }
  }

  @media (max-width: 820px) {
    .topic-layout {
      grid-template-columns: 1fr;
    }

    .topic-layout__sidebar {
      display: none;
    }

    main {
      padding: 1.5rem;
    }
  }
</style>
